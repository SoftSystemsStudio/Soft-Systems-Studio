# ClientConfig contract (internal)

This document describes the canonical shape used by the intake → config → prompts pipeline.
Keep this file as the single source of truth for prompt authors and backend mapping.

## Top-level shape

JSON example:

```json
{
  "clientId": "client-123",
  "profile": {
    "companyName": "Example Inc.",
    "website": "https://example.com",
    "industry": "retail",
    "size": "50-200"
  },
  "contact": {
    "name": "Alice Example",
    "email": "alice@example.com"
  },
  "subsystems": [
    {
      "id": "support",
      "type": "support_system",
      "description": "Customer support workflows and tooling",
      "settings": { "channels": ["email", "chat"], "sla": "24h" }
    },
    {
      "id": "workflow",
      "type": "workflow_system",
      "description": "Task automation and approvals",
      "settings": { "tools": ["zapier", "n8n"] }
    }
  ],
  "createdAt": "2025-12-01T00:00:00.000Z"
}
```

## Required fields

- `clientId` (string): unique identifier for the client. Generated by the intake mapper if not provided.
- `profile.companyName` (string): display name of the company.
- `contact.email` (string): primary contact email for follow-up.
- `subsystems` (array): array of subsystem objects (may be empty array but present).

If any of these are missing the API or prompt mapper should fail fast and return a clear validation error to the caller.

## Optional fields

- `profile.website` (string): canonical website URL.
- `profile.industry`, `profile.size` (string): human-friendly tags used for tailoring language and examples in prompts.
- `contact.name`, `contact.phone` (string): optional contact metadata.
- Subsystem object fields:
  - `description` (string): short human description of the subsystem's scope.
  - `settings` (object): free-form JSON storing subsystem-specific options and feature flags.

## Subsystem object shape

- `id` (string): local identifier for the subsystem (e.g., `support`, `workflow`).
- `type` (enum string): one of the recognized subsystem types used by prompts and templates. Current set includes:
  - `support_system`
  - `content_system`
  - `data_system`
  - `workflow_system`
  - `voice_system`
  - `security_system`
- `settings` (JSON): typed per subsystem where applicable (see below).

## How prompts interpret `subsystems`

- Prompts receive a pretty-printed `ClientConfig` JSON and should:
  1. Prioritize `profile` and `contact` as the lead context for the client.
  2. Summarize each `subsystem` by `type` and `settings` — include human-friendly bullets for key capabilities.

- Example mapping for Phase 1 (Solution Brief / First Sprint):
  - If the client has `support_system` and `workflow_system` selected, Phase 1 focuses on:
    - `support_system`: set up basic ticket routing, knowledge base integration, and an AI-assisted triage flow.
    - `workflow_system`: automate the most frequent support-to-engineer handoffs and approval flows.
  - The prompt template should explicitly call out these two systems in an ordered list and propose a minimal MVP (4–8 week) scope for Phase 1.

- Prompt guidance for authors:
  - Use `profile.industry` and `profile.size` to tailor examples (e.g., "mid-market ecommerce" vs "enterprise finance").
  - Render `subsystem.settings` values as bullet points when relevant (e.g., channels, tools, SLAs).
  - When multiple subsystems are present, propose an integration surface and one early measurable KPI.

## Versioning and changes

This file is the canonical developer-facing contract. If the shape changes, update this document and add a migration path for older `ClientConfig` JSON stored in `ClientConfig.config` rows.

Keep prompt templates in `packages/agency-core/src/prompts.ts` aligned with this contract.
